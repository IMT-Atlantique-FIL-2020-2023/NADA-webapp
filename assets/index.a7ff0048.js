var G=Object.defineProperty,Z=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var E=(e,t,n)=>t in e?G(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,$=(e,t)=>{for(var n in t||(t={}))W.call(t,n)&&E(e,n,t[n]);if(R)for(var n of R(t))K.call(t,n)&&E(e,n,t[n]);return e},M=(e,t)=>Z(e,Y(t));import{c as b,o as u,a as A,m as B,r as s,b as g,w as l,d as r,e as C,u as X,f as J,s as O,g as z,h as x,i as T,V as Q,j as I,F as k,k as F,l as ee,n as te,p as q,t as ne,q as L,v as oe,x as se,y as V,H as ae,A as re,I as ie,z as le,B as ce,C as de,D as ue,E as pe,G as me,J as _e,K as he,L as fe}from"./vendor.258f2589.js";const ge=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}};ge();const ve={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24"},ye=A("path",{d:"M3.55 18.54l1.41 1.41l1.8-1.79l-1.42-1.42M11 22.45h2V19.5h-2m1-14a6 6 0 0 0-6 6a6 6 0 0 0 6 6a6 6 0 0 0 6-6c0-3.32-2.69-6-6-6m8 7h3v-2h-3m-2.76 7.66l1.8 1.79l1.41-1.41l-1.79-1.8m1.79-12.28l-1.41-1.41l-1.8 1.79l1.42 1.42M13 .55h-2V3.5h2m-9 7H1v2h3m2.76-7.66l-1.8-1.79l-1.41 1.41l1.79 1.8l1.42-1.42z",fill:"currentColor"},null,-1),$e=[ye];function be(e,t){return u(),b("svg",ve,$e)}var we={name:"mdi-white-balance-sunny",render:be};const Me={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24"},Ae=A("path",{d:"M2 12a10 10 0 0 0 13 9.54a10 10 0 0 1 0-19.08A10 10 0 0 0 2 12z",fill:"currentColor"},null,-1),Ce=[Ae];function xe(e,t){return u(),b("svg",Me,Ce)}var Se={name:"mdi-moon-waning-crescent",render:xe};var f=(e,t)=>{for(const[n,a]of t)e[n]=a;return e};const ze={name:"AppBar",components:{mdiSun:we,mdiMoon:Se},data(){return{dark:!1}},mounted(){this.dark=this.$store.state.common.theme!=null},methods:M($({},B("common",["setTheme"])),{updateTheme(){this.setTheme(this.dark)}})},De=C("N.A.D.A");function ke(e,t,n,a,o,i){const c=s("n-space"),d=s("mdi-sun"),m=s("mdi-moon"),_=s("n-switch");return u(),g(c,{class:"nada-bar"},{default:l(()=>[r(c,null,{default:l(()=>[De]),_:1}),r(c,{class:"align-right"},{default:l(()=>[r(_,{value:o.dark,"onUpdate:value":[t[0]||(t[0]=p=>o.dark=p),i.updateTheme],class:"theme-switch"},{checked:l(()=>[r(d)]),unchecked:l(()=>[r(m)]),_:1},8,["value","onUpdate:value"])]),_:1})]),_:1})}var Ie=f(ze,[["render",ke],["__scopeId","data-v-0f4e1795"]]);const Be={name:"AppFooter"},Te=C(" @nada webapp is a free and open-source app for the analysis of meteorological data. "),Le=A("a",{href:"https://github.com/IMT-Atlantique-FIL-2020-2023/NADA-webapp"}," browse on github ",-1),Pe=[Te,Le];function Re(e,t,n,a,o,i){return u(),b("div",null,Pe)}var Ee=f(Be,[["render",Re]]);const Oe={name:"Alerts",setup(){const e=X();return{error(t){e.error(t,{closable:!0,duration:1e4})},info(t){e.info(t,{closable:!0,duration:1e4})}}},data(){return{message:null}},watch:{"$store.state.common.error"(e){this.error(e)},"$store.state.common.info"(e){this.info(e)}}};function Fe(e,t,n,a,o,i){return u(),b("div")}var qe=f(Oe,[["render",Fe],["__scopeId","data-v-2852903a"]]);const Ve={name:"Loader",setup(){const e=J();return{start(){e.start()},finish(){e.finish()},error(){e.error()}}},watch:{"$store.state.common.loading"(e){switch(e){case"start":{this.start();break}case"finish":{this.finish();break}case"error":{this.error();break}}}}};function Ne(e,t,n,a,o,i){return u(),b("div")}var Ue=f(Ve,[["render",Ne],["__scopeId","data-v-b991b43a"]]);const je={name:"App",components:{AppBar:Ie,AppFooter:Ee,Alerts:qe,Loader:Ue}},He={class:"nada-fullheight"};function Ge(e,t,n,a,o,i){const c=s("n-global-style"),d=s("app-bar"),m=s("alerts"),_=s("loader"),p=s("router-view"),h=s("app-footer"),w=s("n-loading-bar-provider"),v=s("n-message-provider"),y=s("n-config-provider");return u(),g(y,{class:"nada-main",theme:e.$store.state.common.theme},{default:l(()=>[r(v,null,{default:l(()=>[r(w,null,{default:l(()=>[r(c),A("div",He,[r(d,{class:"nada-header"}),r(m),r(_),r(p,{class:"nada-content"}),r(h,{class:"nada-footer"})])]),_:1})]),_:1})]),_:1},8,["theme"])}var Ze=f(je,[["render",Ge]]);const Ye={name:"SplitPane",components:{Splitpanes:O.exports.Splitpanes,Pane:O.exports.Pane},props:{side:{type:Number,default:null},horizontal:{type:Boolean,default:!1},closing:{type:Boolean,default:!1}},emits:["resize","resized"],data(){return{size:50}},mounted(){this.size=this.side},methods:{resize(e){this.$emit("resize",e)},resized(e){this.$emit("resized",e)}}},We={class:"split-container"};function Ke(e,t,n,a,o,i){const c=s("pane"),d=s("splitpanes");return u(),b("div",We,[r(d,{class:"default-theme",horizontal:n.horizontal,onResize:i.resize,onResized:i.resized},{default:l(()=>[r(c,{size:o.size},{default:l(()=>[z(e.$slots,"left")]),_:3},8,["size"]),r(c,null,{default:l(()=>[z(e.$slots,"right")]),_:3})]),_:3},8,["horizontal","onResize","onResized"])])}var Xe=f(Ye,[["render",Ke]]);const Je={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24"},Qe=A("path",{d:"M15 19l-6-2.11V5l6 2.11M20.5 3h-.16L15 5.1L9 3L3.36 4.9c-.21.07-.36.25-.36.48V20.5a.5.5 0 0 0 .5.5c.05 0 .11 0 .16-.03L9 18.9l6 2.1l5.64-1.9c.21-.1.36-.25.36-.48V3.5a.5.5 0 0 0-.5-.5z",fill:"currentColor"},null,-1),et=[Qe];function tt(e,t){return u(),b("svg",Je,et)}var nt={name:"mdi-map",render:tt};const ot={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24"},st=A("path",{d:"M12 18a6 6 0 0 1-6-6c0-1 .25-1.97.7-2.8L5.24 7.74A7.93 7.93 0 0 0 4 12a8 8 0 0 0 8 8v3l4-4l-4-4m0-11V1L8 5l4 4V6a6 6 0 0 1 6 6c0 1-.25 1.97-.7 2.8l1.46 1.46A7.93 7.93 0 0 0 20 12a8 8 0 0 0-8-8z",fill:"currentColor"},null,-1),at=[st];function rt(e,t){return u(),b("svg",ot,at)}var it={name:"mdi-sync",render:rt};const lt={name:"SubBar",components:{mdiMap:nt,mdiSync:it},computed:$({},x("analysis",["getAirports","getAirport","getAirportId"])),mounted(){this.fetchAirports()},methods:M($({},T("analysis",["fetchAirports","selectAirportById"])),{selectAirport(e){this.selectAirportById(e)},reloadData(){this.fetchAirports()}})},ct=C("Horizontal"),dt=C("Vertical"),ut=C(" Recharger ");function pt(e,t,n,a,o,i){const c=s("n-select"),d=s("n-form-item"),m=s("mdi-map"),_=s("n-button"),p=s("n-radio-button"),h=s("n-radio-group"),w=s("mdi-sync"),v=s("n-form"),y=s("n-space");return u(),g(y,{class:"nada-subbar"},{default:l(()=>[r(v,{inline:"","label-placement":"left","show-feedback":!1},{default:l(()=>[r(d,{label:"A\xE9roport"},{default:l(()=>[r(c,{value:e.getAirportId,options:e.getAirports,filterable:"",placeholder:"Selectionnez un a\xE9roport","onUpdate:value":i.selectAirport},null,8,["value","options","onUpdate:value"])]),_:1}),r(d,null,{default:l(()=>[r(_,{onClick:t[0]||(t[0]=D=>e.$store.state.analysis.activemap=!0)},{icon:l(()=>[r(m)]),_:1})]),_:1}),r(d,{style:{"padding-right":"120px"}},{default:l(()=>[r(h,{value:e.$store.state.analysis.layout,"onUpdate:value":t[1]||(t[1]=D=>e.$store.state.analysis.layout=D)},{default:l(()=>[r(p,{value:"h"},{default:l(()=>[ct]),_:1}),r(p,{value:"v"},{default:l(()=>[dt]),_:1})]),_:1},8,["value"])]),_:1}),r(d,{class:"align-right"},{default:l(()=>[r(_,{type:"info",loading:e.$store.state.common.loading=="start",onClick:t[2]||(t[2]=D=>i.reloadData())},{icon:l(()=>[r(w)]),default:l(()=>[ut]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})}var mt=f(lt,[["render",pt],["__scopeId","data-v-7b142ec9"]]);const _t={name:"Datagrid",components:{VGrid:Q},data(){return{columns:[{prop:"sensor",name:"Sensor",size:80,sortable:!0},{prop:"id",name:"Id",sortable:!0},{prop:"startDate",name:"D\xE9but",columnType:"date",sortable:!0,order:"asc"},{prop:"endDate",name:"Fin",columnType:"date",sortable:!0},{prop:"mesure",name:"Mesure",sortable:!0},{prop:"name",name:"Label",sortable:!0},{prop:"unit",name:"Unit\xE9e",sortable:!0},{prop:"value",name:"Valeur",sortable:!0}],grouping:["name","sensor"],autosize:{mode:"headerClickAutosize ",allColumns:!0}}},computed:{grouped(){return{props:this.grouping,expandedAll:!0}}},methods:M($({},x("analysis",["getSelectedData"])),{isThemeDark(){return this.$store.state.common.theme!==null}})},ht=A("h3",null,"Grouping",-1);function ft(e,t,n,a,o,i){const c=s("v-grid"),d=s("n-layout-content"),m=s("n-checkbox"),_=s("n-gi"),p=s("n-grid"),h=s("n-checkbox-group"),w=s("n-layout-sider"),v=s("n-layout");return u(),g(v,{"has-sider":"","sider-placement":"right",style:{height:"calc(100% - 350px)"}},{default:l(()=>[r(d,{"content-style":"padding: 24px;"},{default:l(()=>[r(c,{theme:i.isThemeDark()?"darkMaterial":"material",columns:o.columns,grouping:i.grouped,source:e.getSelectedData(),filter:!1,"auto-size-column":o.autosize},null,8,["theme","columns","grouping","source","auto-size-column"])]),_:1}),r(w,{"collapse-mode":"transform","default-collapsed":!0,"collapsed-width":20,width:200,"show-trigger":"arrow-circle","content-style":"padding: 0px 20px;",bordered:""},{default:l(()=>[ht,r(h,{value:o.grouping,"onUpdate:value":t[0]||(t[0]=y=>o.grouping=y)},{default:l(()=>[r(p,{"y-gap":8,cols:1},{default:l(()=>[(u(!0),b(k,null,I(o.columns,y=>(u(),g(_,{key:y.prop},{default:l(()=>[r(m,{value:y.prop,label:y.name},null,8,["value","label"])]),_:2},1024))),128))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})}var gt=f(_t,[["render",ft]]);const vt={name:"Interval",computed:$({},x("analysis",["getMeasurements","getMeasurement","getMeasurementId"])),methods:M($({},T("analysis",["selectSensorByMesureId","fetchSensors"])),{selectMeasurement(e){this.selectSensorByMesureId(e)}})};function yt(e,t,n,a,o,i){const c=s("n-date-picker"),d=s("n-form-item"),m=s("n-select"),_=s("n-space"),p=s("n-form");return u(),g(p,{inline:"","label-placement":"left","show-feedback":!1},{default:l(()=>[r(d,{label:"P\xE9riode"},{default:l(()=>[r(c,{value:e.$store.state.analysis.period,"onUpdate:value":[t[0]||(t[0]=h=>e.$store.state.analysis.period=h),t[1]||(t[1]=h=>e.fetchSensors())],style:{"padding-right":"220px"},type:"datetimerange","show-feedback":!0,"update-value-on-close":!0},null,8,["value"])]),_:1}),r(_,{class:"align-right"},{default:l(()=>[r(m,{style:{width:"200px"},value:e.getMeasurementId,options:e.getMeasurements,"virtual-scroll":!1,"show-feedback":!0,filterable:"",placeholder:"Mesure affich\xE9e","onUpdate:value":i.selectMeasurement},null,8,["value","options","onUpdate:value"])]),_:1})]),_:1})}var $t=f(vt,[["render",yt]]);const bt=F({name:"Timeline",data(){return{debouncedFn:ee((...e)=>this.getSelection(...e),200),barChart:null,barChartOptions:{chart:{id:"chart1",brush:{target:"chart2",enabled:!0},toolbar:{show:!1,autoSelected:"selection"},selection:{enabled:!0,fill:{color:"#579ee6",opacity:.3},stroke:{opacity:0}},animations:{enabled:!0,easing:"easeinout",speed:800,animateGradually:{enabled:!1,delay:150},dynamicAnimation:{enabled:!0,speed:100}}},dataLabels:{enabled:!1},xaxis:{type:"datetime"},yaxis:{tickAmount:2,decimalsInFloat:2}}}},computed:{series(){return[{data:this.getTimeline()}]}},watch:{"$store.state.common.theme"(){this.setPopupTheme(this.barChart),this.setDefaultSelection(this.barChart)},"$store.state.common.resized"(){this.setDefaultSelection(this.barChart)}},methods:M($($({},x("analysis",["getTimeline"])),B("analysis",["setSelection"])),{barChartMounted(){this.barChart=this.$refs.barChart,this.setDefaultSelection(this.barChart)},getSelection(e,{xaxis:t,yaxis:n}){this.getTimeline().map(o=>o[0]).sort((o,i)=>i-o).length&&this.setSelection([t.min,t.max])},getDefaultSelectionInterval(){const e=this.getTimeline();if(!e.length)return[];const t=this.getTimeline().length-1;return[e[0][0],e[t][0]]},setDefaultSelection(e){const t=this.getDefaultSelectionInterval();e.updateOptions({chart:{selection:{xaxis:{min:t.length?t[0]:null,max:t.length?t[1]:null}}}})},setPopupTheme(e){e.updateOptions({tooltip:{theme:this.$store.state.common.theme==null?"light":"dark"}})}})});function wt(e,t,n,a,o,i){const c=s("apexchart");return u(),g(c,{ref:"barChart",width:"100%",height:"160px",type:"bar",options:e.barChartOptions,series:e.series,onSelection:e.debouncedFn,onMounted:e.barChartMounted},null,8,["options","series","onSelection","onMounted"])}var Mt=f(bt,[["render",wt]]);const At={name:"Drawer",props:{side:{type:Number,default:null},cclass:{type:String,default:""},dtitle:{type:String,default:""}},computed:{active:{get:function(){return this.$store.state.analysis.activemap},set:function(e){this.$store.state.analysis.activemap=e}}}};function Ct(e,t,n,a,o,i){const c=s("n-drawer-content"),d=s("n-drawer");return u(),b(k,null,[A("div",{id:"drawer-target",class:te(n.cclass)},[z(e.$slots,"content")],2),r(d,{show:i.active,"onUpdate:show":t[0]||(t[0]=m=>i.active=m),placement:"top",to:"#drawer-target",style:{height:"100%"}},{default:l(()=>[r(c,{closable:!0,title:n.dtitle},{default:l(()=>[z(e.$slots,"drawer")]),_:3},8,["title"])]),_:3},8,["show"])],64)}var xt=f(At,[["render",Ct]]),St="/NADA-webapp/assets/marker.6852aa8d.svg";const zt={name:"MapContainer",emits:["selection","zoomChanged","centerChanged"],data(){return{center:[0,0],zoom:8,currentZoom:0,currentCenter:[0,0]}},methods:{selection(e){this.$emit("selection",e)},zoomChanged(e){this.$emit("zoomChanged",e),this.currentZoom=e},centerChanged(e){this.$emit("centerChanged",e),this.currentCenter=e}}};function Dt(e,t,n,a,o,i){const c=s("ol-view"),d=s("ol-source-osm"),m=s("ol-tile-layer"),_=s("ol-interaction-select"),p=s("ol-vector-layer"),h=s("ol-map");return u(),g(h,null,{default:l(()=>[r(c,{center:o.center,zoom:o.zoom,projection:"EPSG:3857",onZoomChanged:i.zoomChanged,onCenterChanged:i.centerChanged},null,8,["center","zoom","onZoomChanged","onCenterChanged"]),r(m,null,{default:l(()=>[r(d,{"image-smoothing":!0})]),_:1}),r(_,{onSelect:i.selection},null,8,["onSelect"]),r(p,null,{default:l(()=>[z(e.$slots,"overlay")]),_:3}),z(e.$slots,"layout")]),_:3})}var N=f(zt,[["render",Dt]]);const kt={name:"MapAirports",components:{MapContainer:N},data(){return{marker:St,coordinates:[],zoom:8,center:[0,0]}},computed:M($({},x("analysis",["getAirports","getAirport","getAirportsCoordinates"])),{mappedCoordinates(){return this.coordinates.map(e=>({label:e.label,value:e.value,coordinates:q(e.coordinates)}))}}),async mounted(){this.coordinates=this.getAirportsCoordinates,this.coordinates.length&&(this.$refs.map.center=this.mappedCoordinates[0].coordinates)},methods:M($({},T("analysis",["selectAirportById"])),{selection(e){const t=ne(e.mapBrowserEvent.coordinate),n=this.coordinates.filter(a=>{if(!a.coordinates.length)return!1;const o=a.coordinates[0]-t[0],i=a.coordinates[1]-t[1];return Math.abs(o)+Math.abs(i)<1});if(n.length)this.selectAirportById(n[0].value),this.$store.state.analysis.activemap=!1;else{const a=new Date().toTimeString().split(" ")[0];this.$store.state.common.error=`[${a}] An error occured during the selection...`}},mooved(e){this.center=e.map(t=>Number(t).toFixed(2))},zoomed(e){this.zoom=Number(e).toFixed(2)}})};function It(e,t,n,a,o,i){const c=s("ol-geom-point"),d=s("ol-style-icon"),m=s("ol-style-text"),_=s("ol-style"),p=s("ol-feature"),h=s("ol-source-vector"),w=s("n-statistic"),v=s("n-col"),y=s("n-row"),D=s("map-container");return u(),g(D,{ref:"map",style:{height:"calc(100% - 80px)"},onSelection:i.selection,onZoomChanged:i.zoomed,onCenterChanged:i.mooved},{overlay:l(()=>[r(h,null,{default:l(()=>[(u(!0),b(k,null,I(i.mappedCoordinates,(P,H)=>(u(),g(p,{key:H},{default:l(()=>[r(c,{coordinates:P.coordinates},null,8,["coordinates"]),r(_,null,{default:l(()=>[r(d,{src:o.marker,scale:5.2,opacity:.9},null,8,["src","scale","opacity"]),r(m,{text:P.label,scale:1.3,"offset-y":10},null,8,["text","scale"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),layout:l(()=>[r(y,{style:{"margin-bottom":"10px"}},{default:l(()=>[r(v,{span:12},{default:l(()=>[r(w,{label:"Coordonn\xE9es"},{default:l(()=>[C(" ["+L(o.center[0])+"; "+L(o.center[1])+"] ",1)]),_:1})]),_:1}),r(v,{span:12},{default:l(()=>[r(w,{label:"Zoom"},{default:l(()=>[C(" x"+L(o.zoom),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["onSelection","onZoomChanged","onCenterChanged"])}var Bt=f(kt,[["render",It]]);const Tt={name:"Weather",data(){return{showModal:!1}}},Lt={style:{height:"calc(100vh - 350px)",position:"relative"}},Pt=C("Log in");function Rt(e,t,n,a,o,i){const c=s("n-button"),d=s("n-result"),m=s("n-modal");return u(),b("div",Lt,[r(d,{class:"vcentered",status:"403",title:"403 Forbidden",description:"Only logged users can access to this."},{footer:l(()=>[r(c,{onClick:t[0]||(t[0]=_=>o.showModal=!0)},{default:l(()=>[Pt]),_:1})]),_:1}),r(m,{show:o.showModal,"onUpdate:show":t[1]||(t[1]=_=>o.showModal=_),preset:"dialog",title:"Coming soon...",content:"Sorry, this feature is not yet available. Come back later.","positive-text":"Close"},null,8,["show"])])}var Et=f(Tt,[["render",Rt],["__scopeId","data-v-23ab1cda"]]);const Ot={name:"Position",components:{MapContainer:N},data(){return{map:null,trajectories:[]}},methods:M($({},x("analysis",["getSensorsByType","getMeanMeasureInterval"])),{setup(){var c,d,m,_;const e=this.$store.state.analysis.airport,t=q([e==null?void 0:e.lon,e==null?void 0:e.lat]),n=this.getSensorsByType(),a=[n.filter(p=>p.id==="longitude")[0],n.filter(p=>p.id==="latitude")[0]];if(a.length<2||!((c=a[0])==null?void 0:c.sensors.length)||!((d=a[1])==null?void 0:d.sensors.length)||((m=a[0])==null?void 0:m.sensors.length)!==((_=a[1])==null?void 0:_.sensors.length))return;const o=a.map(p=>p.sensors[0].getMeanMeasureInterval.map(h=>h.value)),i=o[0].map((p,h)=>[t[0]+o[0][h],t[1]+o[1][h]]);this.trajectories=i.filter(p=>Boolean(p[0])&&Boolean(p[1])),this.map.center=t,this.map.zoom=20}}),watch:{"$store.state.analysis.sensors"(){this.setup()}},mounted(){this.map=this.$refs.map,this.setup()},computed:{trajectory(){}}};function Ft(e,t,n,a,o,i){const c=s("ol-geom-line-string"),d=s("ol-style-stroke"),m=s("ol-style"),_=s("ol-feature"),p=s("ol-source-vector"),h=s("map-container");return u(),g(h,{ref:"map",style:{height:"100%"}},{overlay:l(()=>[r(p,null,{default:l(()=>[r(_,null,{default:l(()=>[r(c,{coordinates:o.trajectories},null,8,["coordinates"]),r(m,null,{default:l(()=>[r(d,{color:"red",width:10})]),_:1})]),_:1})]),_:1})]),_:1},512)}var qt=f(Ot,[["render",Ft]]);const Vt=F({name:"AreaChart",props:{data:{type:Array,default:[]},color:{type:String,default:""},title:{type:String,default:""},legend:{type:String,default:""}},data(){return{areaChart:null,areaChartOptions:{colors:[this.color],chart:{id:"chart1",toolbar:{show:!1,autoSelected:"pan"}},dataLabels:{enabled:!1},xaxis:{type:"datetime"},yaxis:{tickAmount:3,decimalsInFloat:2}}}},computed:{series(){return[{data:this.data}]},filteredSeries(){if(!this.$store.state.analysis.selection.length)return this.series;if(this.$store.state.analysis.selection[0]==null)return this.series;if(this.$store.state.analysis.selection[1]==null)return this.series;const e=this.$store.state.analysis.selection[0],t=this.$store.state.analysis.selection[1];return[{data:this.data.filter(n=>n[0]>=e&&n[0]<=t)}]}},watch:{"$store.state.common.theme"(){this.setPopupTheme(this.areaChart)},"$store.state.analysis.sensor"(){this.areaChart.updateOptions({}),this.setMinMaxValue(this.areaChart)}},methods:M($($({},x("analysis",["getTimeline"])),B("analysis",["setSelection"])),{areaChartMounted(){this.areaChart=this.$refs.areaChart,this.setPopupTheme(this.areaChart),this.setLabel(this.areaChart)},setPopupTheme(e){console.log(e),e.updateOptions({tooltip:{theme:this.$store.state.common.theme==null?"light":"dark"}})},setLabel(e){e.updateOptions({xaxis:{title:{text:this.title}},yaxis:{title:{text:this.legend}}})},setMinMaxValue(e){e.updateOptions({yaxis:{max:Math.max(...this.data.map(t=>t[1])),min:Math.min(...this.data.map(t=>t[1]))}})}})});function Nt(e,t,n,a,o,i){const c=s("apexchart");return u(),g(c,{ref:"areaChart",width:"100%",height:"180px",type:"area",options:e.areaChartOptions,series:e.filteredSeries,onMounted:e.areaChartMounted},null,8,["options","series","onMounted"])}var Ut=f(Vt,[["render",Nt]]);const jt={name:"Evolution",components:{AreaChart:Ut},methods:M($({},x("analysis",["getSensorsByType","getMeanMeasureInterval"])),{getColor(e){const t=180*(3-Math.sqrt(5));return`hsl(${e*t+60}, 100%, 75%)`}})};function Ht(e,t,n,a,o,i){const c=s("area-chart"),d=s("n-grid-item"),m=s("n-grid"),_=s("n-collapse-item"),p=s("n-collapse");return u(),g(p,null,{default:l(()=>[(u(!0),b(k,null,I(e.getSensorsByType(),(h,w)=>(u(),g(_,{key:h,title:h.name},{default:l(()=>[r(m,{"x-gap":10,"y-gap":0,cols:1},{default:l(()=>[r(d,null,{default:l(()=>[(u(!0),b(k,null,I(h.sensors,(v,y)=>(u(),g(c,{key:v,data:e.getMeanMeasureInterval()(v.id,v.measurement.id),title:`Sensor ${v.id}`,legend:`${v.measurement.id} (in ${v.measurement.unit})`,color:i.getColor(w+y)},null,8,["data","title","legend","color"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1})}var Gt=f(jt,[["render",Ht]]);const Zt={name:"Graphs",components:{Weather:Et,Position:qt,Evolution:Gt}};function Yt(e,t,n,a,o,i){const c=s("evolution"),d=s("n-tab-pane"),m=s("weather"),_=s("position"),p=s("n-tabs");return u(),g(p,{"default-value":"evolution",size:"large",style:{height:"100%"}},{default:l(()=>[r(d,{name:"evolution",tab:"Evolution"},{default:l(()=>[r(c)]),_:1}),r(d,{name:"weather",tab:"M\xE9t\xE9o"},{default:l(()=>[r(m)]),_:1}),r(d,{name:"position",tab:"Position",style:{height:"100%"}},{default:l(()=>[r(_,{style:{height:"100%"}})]),_:1})]),_:1})}var Wt=f(Zt,[["render",Yt]]);const Kt={name:"Analysis",components:{SplitPanes:Xe,Interval:$t,Timeline:Mt,Datagrid:gt,Graphs:Wt,SubBar:mt,Drawer:xt,MapAirports:Bt},watch:{"$store.state.analysis.layout"(){this.resized()}},mounted(){window.addEventListener("resize",this.onResize)},unmounted(){window.removeEventListener("resize",this.onResize)},methods:{resized(){this.$store.state.common.resized=new Date},onResize(){window.innerHeight<800&&(this.$store.state.analysis.layout="v")}}},Xt={class:"nada-pane"},Jt={class:"nada-pane"};function Qt(e,t,n,a,o,i){const c=s("sub-bar"),d=s("interval"),m=s("timeline"),_=s("datagrid"),p=s("graphs"),h=s("split-panes"),w=s("n-skeleton"),v=s("map-airports"),y=s("drawer");return u(),b("div",null,[r(c),r(y,{cclass:"nada-split",dtitle:"Carte des a\xE9roports"},{content:l(()=>[r(h,{side:50,horizontal:e.$store.state.analysis.layout=="v",onResized:i.resized},{left:l(()=>[A("div",Xt,[r(d),r(m),r(_)])]),right:l(()=>[A("div",Jt,[r(p)])]),_:1},8,["horizontal","onResized"])]),drawer:l(()=>[e.$store.state.analysis.activemap?(u(),g(v,{key:1})):(u(),g(w,{key:0,height:"100%",width:"100%"}))]),_:1})])}var U=f(Kt,[["render",Qt]]);const en=[{path:"/",name:"Home",component:U},{path:"/:catchAll(.*)",name:"Home",component:U}],tn=oe({history:se(),routes:en});var nn={theme:V,error:null,info:null,loading:null,resized:new Date},on={getError(e){return e.error},getInfo(e){return e.info}};const sn=new ae({uri:"https://nada-extended.herokuapp.com/query"}),an=new re({link:sn,cache:new ie,connectToDevTools:!0});var j=le({defaultClient:an}),rn={async appoloRequest({state:e},{query:t,error:n}){try{e.loading="start";const a=await j.defaultClient.query({query:ce(t),fetchPolicy:"no-cache"});return e.loading="finish",a}catch{const o=new Date().toTimeString().split(" ")[0];e.error=`[${o}] ${n}`,e.loading="error"}}},ln={setTheme(e,t){e.theme=t?V:null}},cn={namespaced:!0,state:nn,getters:on,actions:rn,mutations:ln},dn={layout:"h",period:[new Date().setHours(0,0,0,0),new Date],day:!1,airport:null,airports:[],sensor:null,sensors:[],selection:[],activemap:!1},un={getAirports(e){return e.airports.map(t=>({label:t.name,value:t.id}))},getAirport(e){var t,n;return{label:(t=e.airport)==null?void 0:t.name,value:(n=e.airport)==null?void 0:n.id}},getAirportId(e){var t;return(t=e.airport)==null?void 0:t.id},getAirportsCoordinates(e){return e.airports.map(t=>({label:t.name,value:t.id,coordinates:[t.lon,t.lat]}))},async getAirportsCoordinatesFromOSM(e,t){return await Promise.all(t.getAirports.map(async n=>await de.get(`https://nominatim.openstreetmap.org/search?q=${n.label}+Airport+France&format=json`).then(a=>{const o=a.data;let i=o.filter(c=>c.osm_type=="node")[0];return i==null&&(i=o[0]),{value:n.value,label:n.label,coordinates:i==null?[]:[i.lon,i.lat]}})))},getMeasurements(e){return e.sensors.map(t=>({measurement:t.measurement.id,label:`${t.id}-${t.measurement.name}`,value:`${t.id}-${t.measurement.id}`}))},getMeasurement(e){var t,n,a,o,i;return{measurement:(t=e.sensor)==null?void 0:t.measurement.id,label:`${(n=e.sensor)==null?void 0:n.id}-${(a=e.sensor)==null?void 0:a.measurement.name}`,value:`${(o=e.sensor)==null?void 0:o.id}-${(i=e.sensor)==null?void 0:i.measurement.id}`}},getMeasurementId(e){var t,n;return`${(t=e.sensor)==null?void 0:t.id}-${(n=e.sensor)==null?void 0:n.measurement.id}`},getSensorsByType(e){const t=e.sensors.map(a=>({id:a.measurement.id,name:a.measurement.name}));return[...new Map(t.map(a=>[a.id,a])).values()].map(a=>({id:a.id,name:a.name,sensors:e.sensors.filter(o=>o.measurement.id===a.id)}))},getMeanMeasureInterval:e=>(t,n)=>{const a=e.sensors.find(o=>o.id===t&&o.measurement.id===n);return(a==null?void 0:a.getMeanMeasureInterval)==null?[]:a.getMeanMeasureInterval.map(o=>{const i=o.startDate==null?"":o.startDate;return[new Date(i).getTime(),o.value]})},getTimeline(e,t){var n,a;return e.sensor==null?[]:t.getMeanMeasureInterval((n=e.sensor)==null?void 0:n.id,(a=e.sensor)==null?void 0:a.measurement.id)},getData(e){return e.sensors.map(t=>{if(t.getMeanMeasureInterval==null)return[];const n=t.measurement;return t.getMeanMeasureInterval.map(a=>({sensor:t.id,id:a.id,startDate:a.startDate,endDate:a.endDate,value:a.value,mesure:n.id,name:n.name,unit:n.unit}))}).flat()},getSelectedData(e,t){return!e.selection.length||e.selection[0]==null||e.selection[1]==null?t.getData:t.getData.filter(n=>new Date(n.startDate)>=new Date(e.selection[0])&&new Date(n.startDate)<=new Date(e.selection[1]))}},pn={async fetchAirports({dispatch:e,commit:t}){var a;let n=await e("common/appoloRequest",{query:`{
              airports {
                    id
                    name
                    elevationFt
                    municipality
                    lat
                    lon
                }
            }`,error:"An error occured during the fetching of the airports. Retrying in 10 seconds..."},{root:!0});for(;n==null;)await new Promise(o=>setTimeout(o,1e4)),n=await e("common/appoloRequest",{query:`{
              airports {
                    id
                    name
                }
            }`,error:"An error occured during the fetching of the airports. Retrying in 10 seconds..."},{root:!0});t("setAirports",n.data.airports),e("selectAirportById",(a=n.data.airports[0])==null?void 0:a.id)},selectAirportDefault({dispatch:e,state:t}){var n;t.airports.length&&e("selectAirportById",(n=t.airports[0])==null?void 0:n.id)},selectAirportById({commit:e,dispatch:t,state:n},a){const o=n.airports.find(i=>i.id===a);e("setAirport",o),t("fetchSensors")},async fetchSensors({commit:e,dispatch:t,state:n}){var o;if(n.airport==null||n.period==null||!((o=n.period)==null?void 0:o.length))return;const a=await t("common/appoloRequest",{query:`{
            getAirportById(id: "${n.airport.id}") {
                name
                id
                sensors {
                    id
                    measurement {
                        id
                        name
                        unit
                    }
                    getMeanMeasureInterval(
                        start: "${new Date(n.period[0]).toISOString()}"
                        end: "${new Date(n.period[1]).toISOString()}"
                        discretize: "1m"
                        discretizeMode: FLUX_DURATION
                    ) {
                        id
                        value
                        startDate
                        endDate
                    }
                }
            }
        }`,error:"An error occured during the fetching of the sensors."},{root:!0});a!=null&&(e("setSensors",a.data.getAirportById.sensors),e("setSensor",a.data.getAirportById.sensors[0]))},selectSensorByMesureId({dispatch:e,commit:t,state:n},a){const o=n.sensors.find(i=>`${i.id}-${i.measurement.id}`===a);t("setSensor",o)}},mn={setAirports(e,t){e.airports=t},setAirport(e,t){e.airport=t},setSensors(e,t){e.sensors=t},setSensor(e,t){e.sensor=t},setSelection(e,t){e.selection=t}},_n={namespaced:!0,state:dn,getters:un,actions:pn,mutations:mn},hn=ue({modules:{common:cn,analysis:_n}});const S=pe(Ze);S.use(me);S.use(tn);S.use(hn);S.use(j);S.use(_e);S.use(he);S.config.globalProperties.$apexcharts=fe;S.mount("#app");
